<!DOCTYPE html>
<html>
  <head>
    <link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
      .btn-file {
          position: relative;
          overflow: hidden;
      }
      .btn-file input[type=file] {
          position: absolute;
          top: 0;
          right: 0;
          min-width: 100%;
          min-height: 100%;
          font-size: 100px;
          text-align: right;
          filter: alpha(opacity=0);
          opacity: 0;
          outline: none;
          background: white;
          cursor: inherit;
          display: block;
      }
  </style>

  </head>
  
<body>
<div id="app" >


    <div class="row">
        <div class="col-md-8 col-md-offset-2 col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2">
            <h3 class="text-center"> Pumpen Steuerung</h3>
            <div class="row">
                <div class=" col-md-8 col-md-offset-2 col-xs-12 btn-group.btn-group-justified btn-group-vertical">
	                <button v-on:click="pump" class="btn btn-primary" type="button"><i class="glyphicon glyphicon-align-justify"></i> Seq. Starten</button>
	                <button v-on:click="pumpAllStart" class="btn btn-primary" type="button"><i class="glyphicon glyphicon-align-left"></i> Alle Starten</button>
	                <button v-on:click="pumpAllStop" class="btn btn-primary" type="button"><i class="glyphicon glyphicon-align-left"></i> Alle Stoppen</button>
                </div>
            </div>


            <div class="row">
                    <div class="col-md-8 col-md-offset-2 text-center">
                    <h3> CSV Datei hochladen </h3>
                    <span class="btn btn-primary btn-file col-xs-12">
                        Browse <input v-on:change="upload" type="file" name="csv" id="csv" >
                    </span>
                </div>
            </div>


            <ul>
                <li v-for="pump in pumps" style="list-style: none;">
                    <!-- Pump {{ $index+1 }} with duration {{pump.Duration}} -->
                </li>
            </ul>
        </div>
    </div>

</div>
</body>
  <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="node_modules/vue/dist/vue.min.js"></script>
  <script type="text/javascript" src="node_modules/vue-resource/dist/vue-resource.js"></script>
  <script type="text/javascript" src="node_modules/d3/d3.js"></script>
  <script type="text/javascript" src="node_modules/datatables.net/js/jquery.dataTables.js"></script>
  <script type="text/javascript">


        var app = new Vue({
            el: '#app',
            computed: {
                width: 10,
                height: 30,
                canvas: function()
                {
                    return this.$el.querySelector('canvas');
                }
            },
            data: {
                pumps: []
            },
            ready : function() {
                this.initPumps();
                this.listenToSSE();
            },
            methods : {
                pump: function(event)
                {
                    this.$http.get("/pump");
                },
                pumpAllStart: function(event)
                {
                    this.$http.get("/pumpAllStart");
                },
                pumpAllStop: function(event)
                {
                    this.$http.get("/pumpAllStop");
                },
                upload: function(event)
                {
                    event.preventDefault();

                    var files = csv.files;

                    var data = new FormData();
                    // for single file
                    data.append('uploadfile', files[0]);

                    this.$http.post('/upload', data, function (data, status, request) {
                    }).error(function (data, status, request) {

                    });

                    $('#csv').val('');
                },

                initPumps: function()
                {
                    for(i=0 ; i <32; i++) {
                        this.pumps.$set(i,{"Note": i, "Channel": 0, "Duration": 0, "State": false});
                    }
                },

                listenToSSE: function()
                {
                    var evtSource = new EventSource("/event");
                    evtSource.onmessage = function(e) {
                        var data = JSON.parse(e.data);
                        app.pumps.$set(data.Id-1, data);
                    }
                }
            },
        });
//    var app = new Vue({
//        el: '#app',
//
//        data : {
//            textinput: 'Too hot, hot damn.',
//            pumps: []
//        },
//
//        ready : function()
//        {
//            this.initPumps();
//            this.listenToSSE();
//            initD3(this.pumps)
//        },
//
//        methods : {
//            pump: function(event)
//            {
//                this.$http.get("/pump");
//            },
//
//            initPumps: function()
//            {
//                for(i=0; i <64; i++) {
//                    this.pumps.$set(i,{"Note": i, "Channel": 0, "Duration": 0, "State": false});
//                }
//            },
//
//            listenToSSE: function()
//            {
//                var evtSource = new EventSource("/event");
//                evtSource.onmessage = function(e) {
//                    var data = JSON.parse(e.data);
//                    app.pumps.$set(data.Id, data.Note);
//                    updateD3(app.pumps);
//                }
//            }
//        }
//
//    });
//
//    function initD3(data)
//    {
//
//        var distDiv = 16;
//
//        var square = 40;
//        var width = square*8.5
//        var height = square*9;
//
//
//
//        d3.select('body').append('svg')
//                .attr('width', width)
//                .attr('height', height)
//                .selectAll('circle.red')
//                .data(data).enter()
//                .append('circle')
//                .style('fill', 'red')
//                .attr('r', square/2 )
//                .attr('cx', function(d){ return ((d.Note % 8) * square + square/2); })
//                .attr('cy', function(d){ return (((8 - (d.Note % 8) + d.Note)/8) * square); })
//
//        d3.select('body').append('svg')
//                .attr('width', width)
//                .attr('height', height)
//                .selectAll('circle.blue')
//                .data(data).enter()
//                .append('circle')
//                .style('fill', 'blue')
//                .attr('r', 2 )
//                .attr('cx', function(d){ return ((d.Note % 8) * square + square/2); })
//                .attr('cy', function(d){ return (((8 - (d.Note % 8) + d.Note)/8) * square); })
//
//
//
//
//    }
//
//    function updateD3(data)
//    {
//        var width = window.innerWidth;
//        var height = window.innerHeight;
//
//        d3.select('body').selectAll('circle.blue')
//                .data(data)
//                .style('fill', 'blue')
//                .attr('r', function(d){ return d.Duration+10; })
//                //.attr('cx', function(d){ return ((d.Note % 8) * width/8 + width/8/2); })
//                //.attr('cy', function(d){ return (((8 - (d.Note % 8) + d.Note)/8) * height/8); })
//    }



</script>



</html>
